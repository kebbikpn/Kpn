{% extends "base.html" %}

{% block title %}LGA Coordinator Dashboard{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Personalized Greeting -->
    <div class="greeting-container">
        <div class="d-flex align-items-center">
            <i class="fas fa-hand-wave greeting-icon"></i>
            <p class="greeting-text" id="personalized-greeting"></p>
        </div>
    </div>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-purple mb-0">
                <i class="fas fa-map-marked"></i> LGA Coordinator Dashboard
            </h2>
            <p class="text-muted">{{ current_user.lga.name if current_user.lga }} LGA - {{ current_user.full_name }}</p>
            <p class="small text-purple"><i class="fas fa-building"></i> <strong>Local Government Area</strong> - Community Leadership & Administration</p>
        </div>
        <div class="d-flex gap-2">
            <span class="badge bg-purple fs-6">LGA COORDINATOR</span>
            <a href="{{ url_for('staff.logout') }}" class="btn btn-outline-secondary">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </div>

    <!-- LGA Management Metrics -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="card bg-gradient-purple text-white lga-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h3 class="card-title mb-1">{{ total_wards or 0 }}</h3>
                            <p class="card-text mb-0">Ward Communities</p>
                            <small class="opacity-75">Under Your Leadership</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-map-marker-alt fa-3x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-dark bg-opacity-25">
                    <small><i class="fas fa-compass"></i> Community guidance</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card bg-gradient-success text-white lga-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h3 class="card-title mb-1">{{ total_members or 0 }}</h3>
                            <p class="card-text mb-0">LGA Members</p>
                            <small class="opacity-75">Active Participants</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-users fa-3x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-dark bg-opacity-25">
                    <small><i class="fas fa-handshake"></i> Community engagement</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card bg-gradient-danger text-white lga-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h3 class="card-title mb-1">{{ pending_ward_approvals or 0 }}</h3>
                            <p class="card-text mb-0">Pending Approvals</p>
                            <small class="opacity-75">Ward Leader Applications</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-user-check fa-3x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-dark bg-opacity-25">
                    <small><i class="fas fa-clock"></i> Awaiting review</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card bg-gradient-info text-white lga-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h3 class="card-title mb-1">{{ new_members_this_month or 0 }}</h3>
                            <p class="card-text mb-0">New This Month</p>
                            <small class="opacity-75">Recent Registrations</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-user-plus fa-3x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-dark bg-opacity-25">
                    <small><i class="fas fa-chart-line"></i> Community growth</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
    
            <!-- LGA Management Tools -->
            <div class="card shadow-lg mb-4 lga-tools">
                <div class="card-header bg-gradient-purple text-white">
                    <h5 class="mb-0"><i class="fas fa-tools"></i> LGA Management Tools</h5>
                    <small class="opacity-75">Local Government Administration</small>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <a href="{{ url_for('leadership.approvals') }}" class="btn btn-lga-purple w-100 p-3">
                                <i class="fas fa-user-shield fa-2x mb-2"></i><br>
                                <strong>Ward Approvals</strong><br>
                                <small class="text-light">Review Ward Leader Applications</small>
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{{ url_for('events.manage') }}" class="btn btn-lga-success w-100 p-3">
                                <i class="fas fa-calendar-check fa-2x mb-2"></i><br>
                                <strong>Community Events</strong><br>
                                <small class="text-light">Organize Local Activities</small>
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{{ url_for('campaigns.manage') }}" class="btn btn-lga-info w-100 p-3">
                                <i class="fas fa-bullhorn fa-2x mb-2"></i><br>
                                <strong>LGA Campaigns</strong><br>
                                <small class="text-light">Local Advocacy & Outreach</small>
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{{ url_for('duty_logs.view_duties') }}" class="btn btn-lga-warning w-100 p-3">
                                <i class="fas fa-chart-bar fa-2x mb-2"></i><br>
                                <strong>Community Reports</strong><br>
                                <small class="text-light">Performance & Analytics</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
    
    <!-- Wards in LGA -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-gradient-success text-white">
                    <h5 class="mb-0"><i class="fas fa-map-marker-alt"></i> Ward Performance - {{ current_user.lga.name }} LGA</h5>
                    <small class="opacity-75">Community Ward Management</small>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        {% for ward_data in ward_performance|sort(attribute='performance', reverse=true) %}
                        <div class="col-md-6 col-lg-4">
                            <div class="card border-purple ward-performance-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="text-purple mb-0">{{ ward_data.name }}</h6>
                                        <span class="badge bg-info">{{ ward_data.users }} members</span>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Community Engagement</small>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-purple" role="progressbar" 
                                                 style="width: {{ ward_data.performance }}%" 
                                                 aria-valuenow="{{ ward_data.performance }}" 
                                                 aria-valuemin="0" aria-valuemax="100">
                                            </div>
                                        </div>
                                        <small class="text-purple"><strong>{{ ward_data.performance|round(1) }}%</strong></small>
                                    </div>
                                    <div class="text-center">
                                        {% if ward_data.performance >= 80 %}
                                            <span class="badge bg-success"><i class="fas fa-star"></i> Excellent</span>
                                        {% elif ward_data.performance >= 60 %}
                                            <span class="badge bg-info"><i class="fas fa-check"></i> Good</span>
                                        {% elif ward_data.performance >= 40 %}
                                            <span class="badge bg-warning"><i class="fas fa-chart-line"></i> Average</span>
                                        {% else %}
                                            <span class="badge bg-danger"><i class="fas fa-exclamation"></i> Needs Support</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- LGA Staff -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-gradient-purple text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-users"></i> Community Members ({{ total_members }})</h5>
                        {% if lga_events > 0 %}
                            <span class="badge bg-info"><i class="fas fa-calendar"></i> {{ lga_events }} Local Events</span>
                        {% endif %}
                    </div>
                    <small class="opacity-75">Active Members in {{ current_user.lga.name }} LGA</small>
                </div>
                <div class="card-body">
                    {% for user in lga_users[:8] %}
                    <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                        <div>
                            <strong>{{ user.full_name }}</strong>
                            <br><small class="text-muted">{{ user.role_title or user.role_type.value|title }} - {{ user.ward.name if user.ward else 'LGA Level' }}</small>
                        </div>
                        <div>
                            {% if user.approval_status.value == 'approved' %}
                                <span class="badge bg-success">Active</span>
                            {% elif user.approval_status.value == 'pending' %}
                                <span class="badge bg-warning">Pending</span>
                            {% else %}
                                <span class="badge bg-danger">Rejected</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
</div>

<!-- LGA Coordinator Custom Styles -->
<style>
:root {
    --lga-primary: #6f42c1;
    --lga-purple: #8e44ad;
}

.bg-gradient-purple { 
    background: linear-gradient(135deg, #6f42c1 0%, #8e44ad 100%); 
}
.bg-gradient-success { 
    background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); 
}
.bg-gradient-danger { 
    background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%); 
}
.bg-gradient-info { 
    background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%); 
}

.lga-card {
    border: none;
    transition: all 0.3s ease;
    overflow: hidden;
    border-radius: 12px;
}

.lga-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(111,66,193,0.15);
}

.lga-tools {
    border: 2px solid var(--lga-purple);
    border-radius: 15px;
}

.btn-lga-purple {
    background: linear-gradient(135deg, #6f42c1 0%, #8e44ad 100%);
    border: none;
    color: white;
    transition: all 0.3s ease;
    border-radius: 10px;
    font-weight: 600;
}

.btn-lga-success {
    background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
    border: none;
    color: white;
    transition: all 0.3s ease;
    border-radius: 10px;
    font-weight: 600;
}

.btn-lga-info {
    background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%);
    border: none;
    color: white;
    transition: all 0.3s ease;
    border-radius: 10px;
    font-weight: 600;
}

.btn-lga-warning {
    background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
    border: none;
    color: #212529;
    transition: all 0.3s ease;
    border-radius: 10px;
    font-weight: 600;
}

.btn-lga-purple:hover,
.btn-lga-success:hover,
.btn-lga-info:hover,
.btn-lga-warning:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(111,66,193,0.3);
    color: white;
}

.text-purple {
    color: var(--lga-purple) !important;
}

.bg-purple {
    background-color: var(--lga-purple) !important;
    color: white;
}

.border-purple {
    border-color: var(--lga-purple) !important;
}

.progress-bar.bg-purple {
    background-color: var(--lga-purple) !important;
}

.text-light {
    color: #f8f9fa !important;
}

.opacity-75 {
    opacity: 0.75;
}

.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(111,66,193,0.1);
}
</style>

<script>
// Initialize personalized greeting
document.addEventListener('DOMContentLoaded', function() {
    const userName = {{ current_user.full_name|tojson }};
    const roleTitle = {{ "LGA Coordinator"|tojson }};
    const lgaName = {{ (current_user.lga.name if current_user.lga else "your LGA")|tojson }};
    const taskReminder = `please manage ${lgaName} community affairs and ward coordination`;
    
    initializeGreeting(userName, roleTitle, taskReminder);
});
</script>
{% endblock %}